---
title: "[BIN] 准备所有所需证书"
date: 2023-12-27T12:22:55+08:00
draft: true
weight: 20
---

# [BIN] 准备所有所需证书


```bash
source /opt/k8s/.env

# 创建CA证书
openssl genrsa -out ${CERTDIR}/ca.key 2048
openssl req -new -key ${CERTDIR}/ca.key -out ${CERTDIR}/ca.csr -subj "/CN=xxfe-CA"
openssl x509 -req -days 36500 -sha1 -extensions v3_ca -extfile <(printf "[v3_ca]\n      \
    basicConstraints = CA:TRUE\n") -signkey ${CERTDIR}/ca.key -in ${CERTDIR}/ca.csr     \
    -out ${CERTDIR}/ca.crt

# 创建kubectl所用的客户端证书
openssl genrsa -out ${CERTDIR}/admin.key 2048
openssl req -new -key ${CERTDIR}/admin.key -out ${CERTDIR}/admin.csr -subj "/CN=kubectl"
openssl x509 -req -days 36500 -in ${CERTDIR}/admin.csr -CA ${CERTDIR}/ca.crt            \
    -CAkey ${CERTDIR}/ca.key -CAcreateserial -out ${CERTDIR}/admin.crt

# 创建Etcd服务端证书
openssl genrsa -out ${CERTDIR}/etcd.key 2048
openssl req -new -key ${CERTDIR}/etcd.key -out ${CERTDIR}/etcd.csr -subj "/CN=etcd"
openssl x509 -req -days 36500 -in ${CERTDIR}/etcd.csr -CA ${CERTDIR}/ca.crt             \
    -extfile <(printf "subjectAltName=DNS:etcd,IP:${NODEIP},IP:127.0.0.1")              \
    -CAkey ${CERTDIR}/ca.key -CAcreateserial -out ${CERTDIR}/etcd.crt

# 创建kube-apiserver的服务端证书
openssl genrsa -out ${CERTDIR}/kubernetes.key 2048
openssl req -new -key ${CERTDIR}/kubernetes.key -out ${CERTDIR}/kubernetes.csr -subj "/CN=kubernetes"
openssl x509 -req -days 36500 -in ${CERTDIR}/kubernetes.csr -CA ${CERTDIR}/ca.crt             \
    -extfile <(printf "subjectAltName=DNS:kubernetes,IP:${NODEIP},IP:127.0.0.1")              \
    -CAkey ${CERTDIR}/ca.key -CAcreateserial -out ${CERTDIR}/kubernetes.crt

```

